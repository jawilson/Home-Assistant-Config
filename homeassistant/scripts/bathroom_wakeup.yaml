alias: Bathroom Wake Up
sequence:
  - condition: and
    conditions:
      - condition: state
        entity_id: group.bathroom_lights
        state: 'off'
      - condition: state
        entity_id: automation.bathroom_motion
        state: 'on'


  # Disable fluxer
  - service: switch.turn_off
    entity_id: switch.bathroom_fluxer
  - service: automation.turn_off
    entity_id:
      - automation.bathroom_motion
      - automation.bathroom_no_motion
      - automation.closet_no_motion


  # Turn on lights softly
  - service: light.turn_on
    entity_id:
      - light.bathroom
      - light.closet_light
    data:
      color_temp: 450
      brightness: 1
  - service: light.turn_on
    entity_id:
      - light.bathroom
      - light.closet_light
    data:
      transition: 480
      color_temp: 450
      brightness: 160
  - delay:
      minutes: 10

  - service: light.turn_on
    entity_id:
      - light.bathroom
      - light.closet_light
    data:
      transition: 480
      color_temp: 400
      brightness: 180
  - delay:
      minutes: 10

  - service: light.turn_on
    entity_id:
      - light.bathroom
      - light.closet_light
    data:
      transition: 600
      color_temp: 225
      brightness: 180
  - delay:
      minutes: 15


  # Restore fluxer
  - service: switch.turn_on
    entity_id: switch.bathroom_fluxer


  # Re-enable motion automations
  - service: automation.turn_on
    entity_id:
      - automation.bathroom_motion
      - automation.bathroom_no_motion
      - automation.closet_no_motion


  # Turn off lights if no motion
  - condition: state
    entity_id: sensor.bathroom_alarm_level
    state: '0'
    for:
      minutes: 10
  - service: light.turn_off
    entity_id: light.bathroom
  - condition: state
    entity_id: sensor.bedroom_alarm_level
    state: '0'
    for:
      minutes: 10
  - service: light.turn_off
    entity_id: light.closet
